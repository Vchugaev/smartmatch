<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .test-section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .test-section h3 { margin-top: 0; color: #333; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 15px; border-radius: 4px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .user-type { display: inline-block; margin: 5px; padding: 5px 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π</h1>
        
        <div class="info">
            <h3>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <p>–≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</p>
            <div class="user-type">HR</div>
            <div class="user-type">CANDIDATE</div>
            <div class="user-type">UNIVERSITY</div>
            <div class="user-type">ADMIN</div>
            <div class="user-type">MODERATOR</div>
            <div class="user-type">ANALYST</div>
        </div>

        <!-- –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ HR -->
        <div class="test-section">
            <h3>üë§ –¢–µ—Å—Ç 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è HR –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <form id="hrRegistrationForm">
                <div class="form-group">
                    <label for="hrEmail">Email:</label>
                    <input type="email" id="hrEmail" name="email" value="hr.test@example.com" required>
                </div>
                <div class="form-group">
                    <label for="hrPassword">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="hrPassword" name="password" value="password123" required>
                </div>
                <div class="form-group">
                    <label for="hrRole">–†–æ–ª—å:</label>
                    <select id="hrRole" name="role" required>
                        <option value="HR">HR</option>
                    </select>
                </div>
                <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å HR</button>
                <button type="button" onclick="testHRJobCreation()">–°–æ–∑–¥–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</button>
            </form>
            <div id="hrResult"></div>
        </div>

        <!-- –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ -->
        <div class="test-section">
            <h3>üéØ –¢–µ—Å—Ç 2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</h3>
            <form id="candidateRegistrationForm">
                <div class="form-group">
                    <label for="candidateEmail">Email:</label>
                    <input type="email" id="candidateEmail" name="email" value="candidate.test@example.com" required>
                </div>
                <div class="form-group">
                    <label for="candidatePassword">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="candidatePassword" name="password" value="password123" required>
                </div>
                <div class="form-group">
                    <label for="candidateRole">–†–æ–ª—å:</label>
                    <select id="candidateRole" name="role" required>
                        <option value="CANDIDATE">CANDIDATE</option>
                    </select>
                </div>
                <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</button>
            </form>
            <div id="candidateResult"></div>
        </div>

        <!-- –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ -->
        <div class="test-section">
            <h3>üè´ –¢–µ—Å—Ç 3: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞</h3>
            <form id="universityRegistrationForm">
                <div class="form-group">
                    <label for="universityEmail">Email:</label>
                    <input type="email" id="universityEmail" name="email" value="university.test@example.com" required>
                </div>
                <div class="form-group">
                    <label for="universityPassword">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="universityPassword" name="password" value="password123" required>
                </div>
                <div class="form-group">
                    <label for="universityRole">–†–æ–ª—å:</label>
                    <select id="universityRole" name="role" required>
                        <option value="UNIVERSITY">UNIVERSITY</option>
                    </select>
                </div>
                <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç</button>
            </form>
            <div id="universityResult"></div>
        </div>

        <!-- –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –≤–∞–∫–∞–Ω—Å–∏–∏ -->
        <div class="test-section">
            <h3>üíº –¢–µ—Å—Ç 4: –°–æ–∑–¥–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏ (—Ç—Ä–µ–±—É–µ—Ç HR –ø—Ä–æ—Ñ–∏–ª—å)</h3>
            <form id="jobCreationForm">
                <div class="form-group">
                    <label for="jobTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏:</label>
                    <input type="text" id="jobTitle" name="title" value="Full Stack Developer" required>
                </div>
                <div class="form-group">
                    <label for="jobDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="jobDescription" name="description" rows="3" required>–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</textarea>
                </div>
                <div class="form-group">
                    <label for="jobLocation">–õ–æ–∫–∞—Ü–∏—è:</label>
                    <input type="text" id="jobLocation" name="location" value="–ú–æ—Å–∫–≤–∞" required>
                </div>
                <div class="form-group">
                    <label for="jobType">–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</label>
                    <select id="jobType" name="type" required>
                        <option value="FULL_TIME">–ü–æ–ª–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å</option>
                        <option value="PART_TIME">–ß–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="jobExperienceLevel">–£—Ä–æ–≤–µ–Ω—å –æ–ø—ã—Ç–∞:</label>
                    <select id="jobExperienceLevel" name="experienceLevel" required>
                        <option value="JUNIOR">–ú–ª–∞–¥—à–∏–π</option>
                        <option value="MIDDLE">–°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="SENIOR">–°—Ç–∞—Ä—à–∏–π</option>
                    </select>
                </div>
                <button type="submit">–°–æ–∑–¥–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</button>
            </form>
            <div id="jobResult"></div>
        </div>
    </div>

    <script>
        let currentToken = null;

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ—Ä–º
        document.getElementById('hrRegistrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await registerUser('hr', 'hrResult');
        });

        document.getElementById('candidateRegistrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await registerUser('candidate', 'candidateResult');
        });

        document.getElementById('universityRegistrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await registerUser('university', 'universityResult');
        });

        document.getElementById('jobCreationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await createJob();
        });

        async function registerUser(type, resultId) {
            const form = document.getElementById(type + 'RegistrationForm');
            const formData = new FormData(form);
            
            const userData = {
                email: formData.get('email'),
                password: formData.get('password'),
                role: formData.get('role')
            };

            try {
                const response = await fetch('http://localhost:3000/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    currentToken = result.accessToken;
                    document.getElementById(resultId).innerHTML = `
                        <div class="result success">
                            <h4>‚úÖ ${type.toUpperCase()} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!</h4>
                            <p><strong>ID:</strong> ${result.user.id}</p>
                            <p><strong>Email:</strong> ${result.user.email}</p>
                            <p><strong>–†–æ–ª—å:</strong> ${result.user.role}</p>
                            <p><strong>–¢–æ–∫–µ–Ω:</strong> ${result.accessToken.substring(0, 20)}...</p>
                            <p><em>–ü—Ä–æ—Ñ–∏–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</em></p>
                        </div>
                    `;
                } else {
                    document.getElementById(resultId).innerHTML = `
                        <div class="result error">
                            <h4>‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h4>
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status}</p>
                            <p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ${result.message}</p>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById(resultId).innerHTML = `
                    <div class="result error">
                        <h4>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function createJob() {
            const form = document.getElementById('jobCreationForm');
            const formData = new FormData(form);
            
            const jobData = {
                title: formData.get('title'),
                description: formData.get('description'),
                location: formData.get('location'),
                type: formData.get('type'),
                experienceLevel: formData.get('experienceLevel'),
                remote: false
            };

            try {
                const response = await fetch('http://localhost:3000/jobs', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cookie': `access_token=${currentToken}`
                    },
                    body: JSON.stringify(jobData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('jobResult').innerHTML = `
                        <div class="result success">
                            <h4>‚úÖ –í–∞–∫–∞–Ω—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞!</h4>
                            <p><strong>ID:</strong> ${result.id}</p>
                            <p><strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> ${result.title}</p>
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${result.status}</p>
                            <p><strong>–ú–æ–¥–µ—Ä–∞—Ü–∏—è:</strong> ${result.moderationStatus}</p>
                            <p><em>HR –ø—Ä–æ—Ñ–∏–ª—å –±—ã–ª —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</em></p>
                        </div>
                    `;
                } else {
                    document.getElementById('jobResult').innerHTML = `
                        <div class="result error">
                            <h4>‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤–∞–∫–∞–Ω—Å–∏–∏</h4>
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status}</p>
                            <p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ${result.message}</p>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('jobResult').innerHTML = `
                    <div class="result error">
                        <h4>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function testHRJobCreation() {
            if (!currentToken) {
                alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ HR –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return;
            }
            
            const jobData = {
                title: 'Test Job',
                description: 'Test job description',
                location: 'Test Location',
                type: 'FULL_TIME',
                experienceLevel: 'JUNIOR',
                remote: false
            };

            try {
                const response = await fetch('http://localhost:3000/jobs', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cookie': `access_token=${currentToken}`
                    },
                    body: JSON.stringify(jobData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    alert('‚úÖ –í–∞–∫–∞–Ω—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ! HR –ø—Ä–æ—Ñ–∏–ª—å –±—ã–ª —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.');
                } else {
                    alert(`‚ùå –û—à–∏–±–∫–∞: ${result.message}`);
                }
            } catch (error) {
                alert(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`);
            }
        }
    </script>
</body>
</html>
